<!DOCTYPE html>
<html xmlns:th="thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            var modifyForm = $("form");
            var memberId = $("input[name = memberId]").val();
            var pwConfirmed = false;


            $(".pwCheck").on("click" , function(){
                 pwConfirmed = false;
                 var password = $("input[name = memberPw]").val();
                 var member = {
                    memberId : memberId,
                    memberPw : password
                }

                $.ajax({
                    url : "/member/passwordCheck",
                    type : "POST",
                    data : JSON.stringify(member),
                    contentType : 'application/json; charset=utf-8',
                    dataType : "text",
                    success : function(result){
                        console.log(result);
                        if(result == 'true'){
                            pwConfirmed = true;
                            alert("비밀번호가 확인되었습니다.");
                        }
                        else{
                            alert("비밀번호가 틀렸습니다.");
                        }
                  }
                });
            })




            $(".btnModify").on("click" , function(){
                console.log(pwConfirmed);
                if(!pwConfirmed){
                    alert("비밀번호를 확인해주세요")
                    return;
                }
                console.log(typeof(memberId));
                var modified = {
                    memberId : memberId,
                    memberPw :  $("input[name = newPw]").val(),
                    memberEmail : $("input[name = memberEmail]").val()
                }

                console.log(modified);

                $.ajax({
                    url : "/member/modify",
                    type : "POST",
                    data : JSON.stringify(modified),
                    contentType : 'application/json; charset=utf-8'
                });

            })//btnModify

           $("#newPw , #newPwConfirm").change( function(){
                var newPw = $("input[name = newPw]").val();
                var confirm = $("input[name = newPwConfirm]").val();
                if( newPw != confirm){
                    $(".confirm").text("비밀번호가 일치하지 않습니다");
                }
                else{
                    $(".confirm").text("비밀번호가 일치 합니다.");
                }
          });

           $(".btnQuit").on("click" , function(){
                modifyForm.attr("action" , "/member/deleteById");
                modifyForm.attr("method" , "get");
                modifyForm.submit();
           })



        })//ready



    </script>
</head>
<body>
    <h1>Modify</h1>
    <form action = "/member/modify" method = "post">
        <div class="form-group">
            <label>ID</label>
            <label>
                <input type="text" class="form-control" name="memberId" th:value="${member.memberId}" readonly/>
            </label>
        </div>
        <div class="form-group">
            <label>Name</label>
            <input type="text" class="form-control" name = "memberName" th:value="${member.memberName}" readonly/>
        </div>
        <div class="form-group">
            <label>Password</label>
            <input type="text" class="form-control" name = "memberPw"/>
            <button type = "button" class = "pwCheck">비밀번호 확인</button>
        </div>
        <div class="form-group">
            <label>New Password</label>
            <input type="text" class="form-control" name = "newPw" id = "newPw"/>

        </div>
        <div class="form-group">
            <label>Password Confirm</label>
            <input type="text" class="form-control" name = "newPwConfirm" id = "newPwConfirm">
            <span class = "confirm"></span>
        </div>

        <div class="form-group">
            <label>Email</label>
            <input type="text" class="form-control" name = "memberEmail" th:value="${member.memberEmail}" />

        </div>
        <button type = "button" class = "btnModify">회원정보 수정</button>
        <button type = "button" class = "btnQuit">회원 탈퇴</button>
    </form>
</body>
</html>