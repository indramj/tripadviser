<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">



    <script th:inline = "javascript">
        $(document).ready(function(){
            var contentid = [[${contentid}]];
            console.log(contentid);
            var item;

            var storagedDates = sessionStorage.getItem("dates");
            if(storagedDates !== null){
                var dates = JSON.parse(storagedDates);
            }


            $('#datepicker').datepicker({
                minDate: dates.startDate,
                dateFormat: 'yy-mm-dd',
                maxDate: dates.endDate

            });
            $('#datepicker').datepicker('setDate', dates.startDate);



            $.getJSON('https://apis.data.go.kr/B551011/KorService1/detailCommon1?MobileOS=ETF&MobileApp=tripADV&_type=json&contentId='+contentid+'&defaultYN=Y&firstImageYN=Y&catcodeYN=N&addrinfoYN=Y&mapinfoYN=Y&overviewYN=Y&serviceKey=jGOpKG0LpnP41D9F4KNPAZ0bOMHcHq%2FFwfl9xjjMbAOo%2Bv%2BEajfqKWA2qzJ95g3F8%2Bn05xV1REJGbyi0tkh1fg%3D%3D' ,

                function(data){
                item = data.response.body.items.item;


                console.log(item[0]);
                $(".title").text(item[0].title);
                $(".img").attr("src" , item[0].firstimage);
                $(".details").html(item[0].overview);
                $(".address").text(item[0].addr1);

            }); //getJSON


            $("#addDest").on("click" , function(){

                var dest = {
                    date : $("#datepicker").val(),
                    title : item[0].title
                    }
                console.log(dest);
                var storagedDestinations = sessionStorage.getItem("destinations");
                var destinations = JSON.parse(storagedDestinations);
                var alreadyInput = false;

                $.each(destinations , function( i , destination){
                    if(destination.date === $("#datepicker").val() && destination.title === item[0].title){
                        alert("이미 추가된 일정입니다.");
                        alreadyInput = true;
                        return false;
                    }

                })
                if(alreadyInput === true){
                    return false;
                }
                destinations.push(dest);
                sessionStorage.setItem('destinations' , JSON.stringify(destinations) )
            })
        })

    </script>
</head>
<body>
<div>
    <span class = "title"></span>
</div>
<div>
    <img class = "img">

</div>
<div>
    주소지 :
    <span class = "address"></span>
</div>
<div class = "info">
    <h2>여행지 정보</h2>
    <div class = "details"></div>
</div>

<div class="container">
    <input id="datepicker" width="450" readonly/>
    <button type="button"  id="addDest">일정추가
    </button>

</div>

</body>
</html>