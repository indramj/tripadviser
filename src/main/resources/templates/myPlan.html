<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns="http://www.w3.org/1999/html">
<th:block th:replace="~{layout/basic::setContent(~{this::content})}"></th:block>
<th:block th:fragment="content"></th:block>
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script th:inline = "javascript">
        $(document).ready(function(){
            var plans = [[${plans}]];

            $.each(plans , function(i , plan){
                var planNo = plan.planNo;
                var dateStr = "";

                var eachDates = getEachDate(plan.startDate , plan.endDate);
                $.each(eachDates , function( i , date){
                    dateStr += '<td>'+date+'</td>';
                    var titleStr = "";
                    $.getJSON('/dest/getDestByDate/'+planNo+'/'+date , function(destinations){
                        titleStr += '<td>';
                        $.each(destinations , function(i , dest){
                            titleStr += ''+dest.destTitle+'';
                            titleStr += '</br>';
                        })
                        titleStr += '</td>';
                        $(".planTable[data-pno = '"+ planNo +"'] .titleList").append(titleStr);
                    })//getJSON
                })
                $(".planTable[data-pno = '"+ planNo +"'] .dateList").append(dateStr);


            })//each

            function getEachDate( startDate , endDate){
                var endDate = new Date(endDate);
                var curDate = new Date(startDate);
                var allDate = [];
                while(curDate <= endDate){
                    var year = curDate.getFullYear();
                    var month = curDate.getMonth() + 1; // JavaScript의 월은 0부터 시작하므로 1을 더합니다.
                    var day = curDate.getDate();
                    var localDate= year + "-" + month + "-" + day;
                    allDate.push(localDate);
                    curDate.setDate(curDate.getDate() + 1);
                }
                console.log(allDate);
                return allDate;
            }


        }) //ready
    </script>
</head>
<body>
<div class="title_name">
    MY Plan
</div>

<div class="box">

    <div th:each = "plan : ${plans}" >

        <div style="text-align:center;" class="plan_date">
        출발일 :
            <span style="margin-right:20px;"th:text = "${plan.startDate}"></span></td>
        종료일 :
            <span style="margin-right:20px;"th:text = "${plan.endDate}"></span></td>

        <button class="delete_button" type = "button" th:data-pno = "${plan.planNo}">일정 삭제</button></td>

        </div>


<div class="plan_box">
        <table style="margin-left:auto;margin-right:auto;" class = "planTable"  th:data-pno = "${plan.planNo}">

            <tr style="margin-left:30px; margin-right:30px;" class = "dateList">
            </tr>

            <tr class = "titleList">
            </tr>

        </table>
</div>
    </div>




</div>
</body>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Noto+Sans+KR&display=swap');

        .title_name{
        margin-top:50px;
        margin-bottom:30px;
        font-size: 45px;
        text-align:center;
        }



        .box{
        width:80%;
        margin: 0 auto;
        margin-top:100px;
        margin-bottom:100px;
        font-family: 'Noto Sans KR', sans-serif;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        }

.plan_box{
margin:0 auto;

}
        .planTable{
        margin-top:30px;
        text-align:center;
        border-spacing: 40px;
  border-collapse: separate;
  padding-right:30px;
        }


        .plan_date{
        margin-top:30px;
        padding-left:130px;
        padding-top:20px;
        padding-bottom:20px;
        font-size:22px;
        }

        .dateList{
        margin-top:20px;
        background-color:snow;
        font-size:18px;
        width:150px;
        height:35px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        }

        .titleList{
        background-color:white;
        font-size:22px;

        }

        .delete_button{
        position: relative;
       border: none;
       display: inline-block;
       padding: 1px 10px;
       border-radius: 15px;
       font-family: 'Noto Sans KR', sans-serif;
       box-shadow: 0 15px 35px rgba(0, 0, 0, 0.05);
       text-decoration: none;
       font-weight: 600;
       transition: 0.25s;
       border: 3px solid aliceblue;
       color: #1e6b7b;
       width:100px;
       height:40px;
       font-size:16px;
       }

       .delete_button:hover{
       color: #1e6b7b;
       background: aliceblue;
       }

     a{
    color:black;
    text-decoration:none;
    }


</style>




</html>